/*! app-0.1.0 */
!function(window){"use strict";function KF5SupportBox(a){this.config=a||{},this.init()}function bindEvent(a,b,c){if(a.addEventListener)return a.addEventListener(b,c,!1);if(a.attachEvent)return a.attachEvent(b,c,!1);throw new Error("Error with binding Event!")}function embed(a,b){var c,d,e,f,g=window.document.createElement("iframe");g.src="javascript:false",g.title="",g.role="presentation",(g.frameElement||g).style.cssText="display: none",window.document.body.appendChild(g),e=g.contentWindow,f=e.document;try{d=f}catch(h){c=window.document.domain,g.src='javascript:var doc=document.open();doc.domain="'+c+'";void(0);',d=f}d.open().start=function(){b&&("object"==typeof b?b.iframeWindow=e:"function"==typeof b&&b(e))},d.write('<body onload="document.start();">'),d.write('<script src="'+a+'""></script>'),d.close()}function getStyle(a,b){var c,d,e=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,f=/^margin/,g=/^(top|right|bottom|left)$/,h=new RegExp("^("+e+")(?!px)[a-z%]+$","i");return window.getComputedStyle?(c=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)},d=function(a,b,d){var e,g,i,j,k=a.style;return d=d||c(a),j=d?d.getPropertyValue(b)||d[b]:void 0,d&&h.test(j)&&f.test(b)&&(e=k.width,g=k.minWidth,i=k.maxWidth,k.minWidth=k.maxWidth=k.width=j,j=d.width,k.width=e,k.minWidth=g,k.maxWidth=i),void 0===j?j:j+""}):document.documentElement.currentStyle&&(c=function(a){return a.currentStyle},d=function(a,b,d){var e,f,i,j,k=a.style;return d=d||c(a),j=d?d[b]:void 0,null==j&&k&&k[b]&&(j=k[b]),h.test(j)&&!g.test(b)&&(e=k.left,f=a.runtimeStyle,i=f&&f.left,i&&(f.left=a.currentStyle.left),k.left="fontSize"===b?"1em":j,j=k.pixelLeft+"px",k.left=e,i&&(f.left=i)),void 0===j?j:j+""||"auto"}),d&&d(a,b)}function animate(a,b,c){function d(){if(clearInterval(j),j=null,!c.carryOn){for(var d in b)a.style[d]=b[d]+"px";"function"==typeof c.callback&&c.callback.call(a)}a._finishAnimation=null}var e={};for(var f in b)e[f]=parseInt(getStyle(a,f));var g=c.duration||500,h=Date.now(),i=0,j=setInterval(function(){i=(Date.now()-h)/g,i=i>1?1:i;var f=easing[c.easing||"swing"](i);for(var j in b)a.style[j]=e[j]+(b[j]-e[j])*f+"px";i>=1&&d()},1e3/60);a._finishAnimation=d}function slideUp(a,b){a._finishAnimation&&a._finishAnimation(),b=b||{};var c,d=b.by||"height";a.style.display="block",c=parseInt(getStyle(a,d)),a.style[d]=(b.from||0)+"px";var e={};e[d]=c,animate(a,e,b)}function slideDown(a,b){a._finishAnimation&&a._finishAnimation(),b=b||{};var c=b.by||"height",d=getStyle(a,c),e=b.callback;"function"==typeof e?b.callback=function(){this.style.display="none",this.style[c]=d,e.call(this)}:b.callback=function(){this.style.display="none",this.style[c]=d};var f={};f[c]=b.to||0,animate(a,f,b)}function hideElement(a){a.style.display="none"}function showElement(a){a.style.display="block"}function cookie(a,b,c){if("undefined"==typeof b){var d=null;if(document.cookie&&""!=document.cookie)for(var e=document.cookie.split(";"),f=0;f<e.length;f++){var g=e[f].replace(/^\s+|\s+$/g,"");if(g.substring(0,a.length+1)==a+"="){d=decodeURIComponent(g.substring(a.length+1));break}}return d}c=c||{},null===b&&(b="",c.expires=-1);var h="";if(c.expires&&("number"==typeof c.expires||c.expires.toUTCString)){var i;"number"==typeof c.expires?(i=new Date,i.setTime(i.getTime()+24*c.expires*60*60*1e3)):i=c.expires,h="; expires="+i.toUTCString()}var j=c.path?"; path="+c.path:"",k=c.domain?"; domain="+c.domain:"",l=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),h,j,k,l].join("")}function isPC(){for(var a=navigator.userAgent,b=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],c=!0,d=0;d<b.length;d++)if(-1!==a.indexOf(b[d])){c=!1;break}return c}var privateData={},script=window.document.getElementById("kf5-provide-supportBox"),parts=script.src.split("//"),assetsHost=parts.length>1?parts[1].split("/")[0]:"assets.kf5.com",kf5Domain=script.getAttribute("kf5-domain"),supportboxConfigURL="//"+kf5Domain+"/supportbox/buttonconfig",date=(new Date).getDay(),_config={btn_name:"帮助按钮",facade:"1",color:"#7A88FF",position:"right",vertical:!1,has_aside:!1,iframeURL:"//"+kf5Domain+"/supportbox/index",btn_icon:"//"+assetsHost+"/supportbox/images/icon2.png",styleURL:"//"+assetsHost+"../css/btn.css",template:'<div id="kf5-support-btn" class="kf5-support-btn" style="{{bg_color}}"> <img src="{{btn_icon}}" alt=""><span>{{title}}</span> </div> <div id="kf5-support-block" class="kf5-support kf5-support-show {{blockClassNames}}" style="display: none;"> <a id="kf5-close-btn" class="kf5-close" title="关闭"><i class="kf5-icon-clear"></i></a> <div id="kf5-loading" class="kf5-loading"> </div> <div id="kf5-iframe-holder" style="display:none;"></div> </div>',noticeTemplate:'<div class="kf5-support-message" style="right:30px;bottom: 30px"> <div class="kf5-support-message-left" style="background-color: #bbb"> <img src="{{avatar}}" alt=""> </div> <div class="kf5-support-message-content"> <div class="kf5-support-message-name">{{title}}</div> <div class="kf5-support-message-info">{{content}}</div> </div> <div class="kf5-support-message-right"> <a id="kf5-support-message-accept" class="kf5-support-message-accept">{{submitText}}</a> <a id="kf5-support-message-reject" class="kf5-support-message-reject">{{cancelText}}</a> </div> </div>',defaultNoticeAvatar:"//"+assetsHost+"/supportbox/images/kf5-icon-talk.png",autoLoadIframe:!0};Date.now=Date.now||function(){return(new Date).getTime()},window.JSON=window.JSON||{stringify:function(a){a&&a.toJSON&&(a=a.toJSON());var b="";if($.isArray(a)){b+="[";for(var c=0;c<a.length;++c)b+=JSON.stringify(a[c])+",";b=b.replace(/,$/,""),b+="]"}else if($.isPlainObject(a)){b+="{";for(var d in a)a.hasOwnProperty(d)&&(b+='"'+d+'":'+JSON.stringify(a[d])+",");b=b.replace(/,$/,""),b+="}"}else b+="number"==typeof a?a:"string"==typeof a?'"'+a+'"':null===a?"null":a;return b},parse:function(jsonStr){return eval("("+jsonStr+")")}},KF5SupportBox.prototype={el:null,getElement:function(a){return window.document.getElementById(a.replace("#",""))},getOpt:function(a){return this.config.hasOwnProperty(a)?this.config[a]:_config[a]},init:function(){return this.initElements(),this},initElements:function(){this._prepareElement(),this.render()},render:function(){var a=this;this._prepareStyle(),a.link.onload=function(){document.body.appendChild(a.el),a.onDidInsertElement(),a._bindEvents(),a.link.onload=null},document.body.appendChild(a.link)},onDidInsertElement:function(){if(this.waitingQueue)for(;this.waitingQueue.length;)this.waitingQueue.shift()(this)},waitingQueue:null,ready:function(a){this.el&&this.el.parentNode?a(this):(this.waitingQueue||(this.waitingQueue=[]),this.waitingQueue.push(a))},_prepareStyle:function(){var a=this.link=window.document.createElement("link");return a.rel="styleSheet",a.type="text/css",a.href=this.getOpt("styleURL")+"?v="+date,this},_prepareElement:function(){var a="kf5-support-123456789";return a+="left"===this.getOpt("position")?" kf5-left":"right"===this.getOpt("position")?" kf5-right":" "+this.getOpt("position"),a+=isNaN(+this.getOpt("facade"))?" "+this.getOpt("facade"):" kf5-style"+(parseInt(this.getOpt("facade"))||1),this.getOpt("is_mobile")&&(a+=" kf5-mobile"),this.el=window.document.createElement("div"),this.el.setAttribute("class",a),this.el.setAttribute("id","kf5-support-123456789"),this.el.innerHTML=this.getOpt("template").replace("{{title}}",this.getOpt("btn_name")||"获取帮助").replace("{{btn_icon}}",this.getOpt("btn_icon")+"?v="+date).replace("{{bg_color}}",this.getOpt("color")?"background:"+this.getOpt("color"):"").replace("{{blockClassNames}}",this.getOpt("has_aside")?"kf5-has-aside":""),this},_bindEvents:function(){var a=this;return this.el.eventBinded||(this.getElement("#kf5-support-btn").onclick=function(){a.open(),a.hideButton()},this.getElement("#kf5-close-btn").onclick=function(){a.close(function(){a.showButton()})},this.el.eventBinded=!0),this.ready(function(){a.getOpt("autoLoadIframe")&&a.loadIframe(),!a.getOpt("is_mobile")&&cookie("kf5-supportBox-autoOpen")&&(a.open(),a.hideButton())}),this},onIframeReady:function(a){var b=this;this.getElement("#kf5-loading").style.display="none",this.iframe=a,this.identifyData&&this.identify(this.identifyData),b.iframe&&b.iframe.contentWindow&&b.iframe.contentWindow.postMessage&&(b.iframe.contentWindow.postMessage("CMD::referrerInfo "+JSON.stringify({title:document.title,url:location.href}),"*"),b.postMessage("CMD::toggleIframePanel",{opened:b.isOpened}))},loadIframe:function(){var a=this,b=this.getElement("#kf5-widget-iframe"),c=this.getElement("kf5-iframe-holder");return b||(b=document.createElement("iframe"),b.setAttribute("id","kf5-widget-iframe"),b.setAttribute("frameborder","0"),b.attachEvent?b.attachEvent("onload",function(){a.onIframeReady(b)}):b.onload=function(){a.onIframeReady(b)}),b.getAttribute("src")||b.setAttribute("src",this.getOpt("iframeURL")),c&&(c.parentNode.insertBefore(b,c),c.parentNode.removeChild(c)),this},reloadIframe:function(){var a=this.getElement("#kf5-widget-iframe");return this.iframe=null,this.getElement("#kf5-loading").style.display="block",a.setAttribute("src",this.getOpt("iframeURL")),this},removeButton:function(){return hideElement(this.getElement("#kf5-support-btn")),this.buttonRemoved=!0,this},showButton:function(a){if(!this.buttonRemoved){var b={duration:300,easing:"swing",callback:a,from:-80};this.getOpt("vertical")?/left/.test(this.getOpt("position"))?b.by="left":b.by="right":b.by="bottom",slideUp(this.getElement("#kf5-support-btn"),b)}},hideButton:function(a){if(!this.buttonRemoved&&!this.getOpt("is_mobile")){var b={duration:300,easing:"swing",callback:a,to:-80};this.getOpt("vertical")?/left/.test(this.getOpt("position"))?b.by="left":b.by="right":b.by="bottom",slideDown(this.getElement("#kf5-support-btn"),b)}},open:function(a){return this.getOpt("is_mobile")?void this.openNewPage():void(this.isOpened||(this.loadIframe(),slideUp(this.getElement("#kf5-support-block"),{duration:300,easing:"swing",callback:a,by:"bottom",from:-450}),this.getOpt("is_mobile")||cookie("kf5-supportBox-autoOpen",1,{expires:.125,path:"/"}),this.isOpened=!0,this.postMessage("CMD::toggleIframePanel",{opened:!0})))},postMessage:function(a,b){this.iframe&&this.iframe.contentWindow&&this.iframe.contentWindow.postMessage&&this.iframe.contentWindow.postMessage(a+" "+JSON.stringify(b),"*")},openNewPage:function(){var a="//"+kf5Domain+"/kchat/",b=this.identifyData,c="";if(b&&"object"==typeof b){var d,e;for(d in b)e=b[d],e="string"==typeof e?e:JSON.stringify(e),c=c&&c+"&",c+=d+"="+e;c="?"+c}window.open(a+c)},close:function(a){slideDown(this.getElement("#kf5-support-block"),{duration:300,easing:"swing",callback:a,by:"bottom",to:-450}),cookie("kf5-supportBox-autoOpen",null,{path:"/"}),this.isOpened=!1,this.postMessage("CMD::toggleIframePanel",{opened:!1})},hide:function(){hideElement(this.el)},show:function(){showElement(this.el)},identify:function(a){if(a){var b=JSON.stringify(a);this.iframe&&this.iframe.contentWindow&&this.iframe.contentWindow.postMessage&&this.iframe.contentWindow.postMessage("CMD::identify "+b,"*"),this.identifyData=a}},showNotice:function(a){var b=this,c=window.document.createElement("div");return a="object"==typeof a?a:{},c.innerHTML=this.getOpt("noticeTemplate").replace("{{title}}",a.title||"提示信息").replace("{{content}}",a.content||"").replace("{{avatar}}",a.avatar||this.getOpt("defaultNoticeAvatar")).replace("{{submitText}}",a.submitText||"接受").replace("{{cancelText}}",a.cancelText||"拒绝"),this.closeNotice(),this.noticeElement=c,window.document.body.appendChild(c),bindEvent(document.getElementById("kf5-support-message-accept"),"click",function(){b.open(),b.hideButton(),b.iframe&&b.iframe.contentWindow&&b.iframe.contentWindow.postMessage("CMD::kf5NoticeAccepted "+JSON.stringify(a.data),"*"),b.closeNotice()}),bindEvent(document.getElementById("kf5-support-message-reject"),"click",function(){b.iframe&&b.iframe.contentWindow&&b.iframe.contentWindow.postMessage("CMD::kf5NoticeRejected "+JSON.stringify(a.data),"*"),b.closeNotice()}),c},closeNotice:function(){this.noticeElement&&(this.noticeElement.parentNode.removeChild(this.noticeElement),this.noticeElement=null)}},KF5SupportBox.waitingQueue=[],KF5SupportBox.onConfigReady=function(){if(!KF5SupportBox.instance)for(KF5SupportBox.init();KF5SupportBox.waitingQueue.length;)KF5SupportBox.waitingQueue.shift()()},KF5SupportBox.ready=function(a){KF5SupportBox.instance?a():KF5SupportBox.waitingQueue.push(a)},KF5SupportBox.init=function(){return KF5SupportBox.instance?void 0:(KF5SupportBox.instance=new KF5SupportBox(privateData.KF5_SUPPORTBOX_BUTTON),KF5SupportBox.instance)},KF5SupportBox.destroy=function(){KF5SupportBox.instance.el.parent.removeChild(KF5SupportBox.instance.el),KF5SupportBox.instance=null},KF5SupportBox.loadConfig=function(){KF5SupportBox.instance||embed(supportboxConfigURL,function(a){a.KF5_SUPPORTBOX_BUTTON&&a.KF5_SUPPORTBOX_BUTTON.show&&(privateData.KF5_SUPPORTBOX_BUTTON=a.KF5_SUPPORTBOX_BUTTON,KF5SupportBox.onConfigReady())})},bindEvent(window,"DOMContentLoaded",KF5SupportBox.loadConfig),bindEvent(window,"load",KF5SupportBox.loadConfig),bindEvent(window.document,"page:load",KF5SupportBox.loadConfig),bindEvent(window.document,"onreadystatechange",function(){"complete"===window.document.readyState&&KF5SupportBox.loadConfig()}),window.initializeKF5SupportBox||(window.initializeKF5SupportBox=KF5SupportBox.loadConfig),bindEvent(window,"message",function(a){var b,c,d;a.data&&"string"==typeof a.data&&(b=a.data.match(/^([^ ]+)(?: +(.*))?/),c=b[1],d=b[2]),"CMD::showSupportbox"===c?KF5SupportBox.instance&&KF5SupportBox.instance.open():"CMD::hideSupportbox"===c?KF5SupportBox.instance&&KF5SupportBox.instance.close(function(){KF5SupportBox.instance.showButton()}):"CMD::resizeIframe"===c||"CMD::kf5Notice"===c&&KF5SupportBox.instance&&KF5SupportBox.instance.showNotice(d&&JSON.parse(d))});var easing={swing:function(a){return.5-Math.cos(a*Math.PI)/2},linear:function(a){return a}};window.KF5SupportBoxAPI={init:KF5SupportBox.loadConfig,ready:KF5SupportBox.ready,removeButton:function(){KF5SupportBox.instance&&KF5SupportBox.instance.ready(function(){KF5SupportBox.instance.removeButton()})},showButton:function(a){KF5SupportBox.instance&&KF5SupportBox.instance.ready(function(){KF5SupportBox.instance.showButton()})},hideButton:function(a){KF5SupportBox.instance&&KF5SupportBox.instance.ready(function(){KF5SupportBox.instance.hideButton()})},refresh:function(){KF5SupportBox.instance&&KF5SupportBox.instance.render()},open:function(a){KF5SupportBox.instance&&KF5SupportBox.instance.ready(function(){KF5SupportBox.instance.open(a)})},close:function(a){KF5SupportBox.instance&&KF5SupportBox.instance.ready(function(){KF5SupportBox.instance.close(a)})},identify:function(a){KF5SupportBox.instance&&a&&KF5SupportBox.instance.identify(a)}}}(window);