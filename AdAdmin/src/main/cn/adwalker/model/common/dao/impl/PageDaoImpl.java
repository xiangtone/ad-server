/** * <p>Title: AppStyleDaoImpl.java</p> * <p>Description: </p> * <p>Copyright: Copyright (c) </p> * <p>Company: adwalker</p> * @author jiangwei * @date Aug 22, 2012 * @version 1.0 */package cn.adwalker.model.common.dao.impl;import java.util.ArrayList;import java.util.Date;import java.util.List;import java.util.Map;import org.apache.commons.lang.ArrayUtils;import org.springframework.jdbc.core.BeanPropertyRowMapper;import org.springframework.stereotype.Repository;import cn.adwalker.core.repository.impl.BaseDaoImpl;import cn.adwalker.model.app.domain.Page;import cn.adwalker.model.common.dao.IPageDao;/** * <p> * Title: AppStyleDaoImpl * </p> * <p> * Description: * </p> * <p> * Company: adwalker * </p> *  * @author jiangwei * @date Aug 22, 2012 */@Repository("pageDao")public class PageDaoImpl extends BaseDaoImpl<Page> implements IPageDao {	public PageDaoImpl() {		setTableName("T_PAGE");	}	/**	 * (non-Javadoc)	 * <p>	 * Title: getPageByAppId	 * </p>	 * 	 * @param app_id	 * @return	 * @see cn.adwalker.model.common.dao.IPageDao#getPageByAppId(java.lang.Long)	 */	@Override	public List<String> getPageByAppId(Long app_id) {		List<String> resultList = new ArrayList<String>();		String sql = "select type.name name from T_PAGE page  left join T_TYPE  type on page.type_id=type.id where  page.status>=0 and  page.app_id=?";		List<Map<String, Object>> list = jdbcTemplate.queryForList(sql, new Object[] { app_id });		for (Map<String, Object> map : list) {			resultList.add((String) map.get("name"));		}		return resultList;	}	@Override	public int saveOrUpdate(Long app_id, String arr[]) {		if (app_id != null && arr != null && arr.length > 0) {			List<Page> pageList = this.findByApp(app_id, null);			StringBuffer sql = new StringBuffer();			List<Object[]> parameters = new ArrayList<Object[]>();			if (pageList != null && pageList.size() > 0) {				for (Page page : pageList) {					if (ArrayUtils.contains(arr, String.valueOf(page.getType_id()))) {						if (page.getStatus() != 1) {							parameters.add(new Object[] { 1, page.getId() });						}					} else {						parameters.add(new Object[] { -1, page.getId() });					}				}				sql.append("update T_PAGE set STATUS=? where id=?");			} else {				String typeArr[] = new String[] { "0", "1", "2", "4", "5" };				sql.append("insert into T_PAGE (APP_ID,TYPE_ID,STATUS,CREATE_TIME,scale,rate) values (?,?,?,?,?,?)");				for (String s : typeArr) {					Integer status = null;					if (ArrayUtils.contains(arr, s)) {						status = 1;					} else {						status = -1;					}					parameters.add(new Object[] { app_id, Integer.valueOf(s), status, new Date(), 1, 1 });				}			}			jdbcTemplate.batchUpdate(sql.toString(), parameters);		}		return 0;	}	private List<Page> findByApp(Long app_id, Integer type) {		List<Page> list = null;		if (app_id != null) {			String sql = " select * from T_PAGE  where app_id = " + app_id;			if (type != null) {				sql = sql + " and status>0";			}			list = jdbcTemplate.query(sql, new BeanPropertyRowMapper<Page>(Page.class));		}		return list;	}	@Override	public List<Page> findByApp(Long app_id) {		return this.findByApp(app_id, 1);	}}